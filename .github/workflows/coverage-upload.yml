name: 'Coverage'
on:
  workflow_call: # Allows pre-check-CI-updates.yml to call it in case of update
    secrets:
      CODACY_PROJECT_TOKEN:
        required: true
      CODECOV_TOKEN:
        required: true
  workflow_run:
    workflows: ["CI"]
    types: [completed]

permissions:
  contents: read
  checks: write # For the check run creation !

jobs:
  coverage:
    name: Coverage
    permissions:
      contents: read
      checks: write # For the check run creation !
    secrets:
      CODACY_PROJECT_TOKEN: ${{ secrets.CODACY_PROJECT_TOKEN }}
      CODECOV_TOKEN: ${{ secrets.CODECOV_TOKEN }}
    uses: yoanm/.github/.github/workflows/reusable-coverage-upload-manager.yml@feature/init # @TODO - !! Move to a tag before merging !!
