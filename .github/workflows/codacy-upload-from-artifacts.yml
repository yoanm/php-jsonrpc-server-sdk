name: 'Codacy report groups upload'
on:
  workflow_call:
    inputs:
      artifacts-pattern:
        required: true
        type: string
    secrets:
      PROJECT_TOKEN:
        required: true
    outputs:
      uploaded-reports:
        description: TODO
        value: ${{ jobs.upload.outputs.uploaded-reports }}

jobs:
  upload:
    name: Upload all reports
    runs-on: ubuntu-latest
    outputs:
      uploaded-reports: ${{ steps.upload.outputs.uploaded-reports }}
    steps:
      # @TODO move codacy-uploader action to a dedicated repo and remove the checkout
      - uses: actions/checkout@v3
        with:
          path: custom-action-repo

      - name: Download artifacts
        uses: actions/download-artifact@v4
        with:
          pattern: ${{ inputs.artifacts-pattern }}
          path: job-artifacts

      - name: Upload all reports
        id: upload
        uses: ./custom-action-repo/.github/actions/codacy-uploader
        with:
          path: job-artifacts
          project-token: ${{ secrets.PROJECT_TOKEN }}

      - name: DEBUG Upload all reports
        run: |
          echo 'outcome='"'"'${{ steps.upload.outcome }}'"'"
          echo 'conclusion='"'"'${{ steps.upload.conclusion }}'"'"
          echo 'outputs='"'"'${{ toJson(steps.upload.outputs) }}'"'"
          echo 'uploaded-reports='"'"'${{ steps.upload.outputs.uploaded-reports }}'"'"
